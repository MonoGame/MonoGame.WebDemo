Bridge.assembly("Platformer2D",function($asm,globals){"use strict";Bridge.define("Platformer2D.Accelerometer",{statics:{fields:{isInitialized:!1,isActive:!1},ctors:{init:function(){this.isInitialized=!1;this.isActive=!1}},methods:{Initialize:function(){if(Platformer2D.Accelerometer.isInitialized)throw new System.InvalidOperationException.$ctor1("Initialize can only be called once");Platformer2D.Accelerometer.isInitialized=!0},GetState:function(){if(!Platformer2D.Accelerometer.isInitialized)throw new System.InvalidOperationException.$ctor1("You must Initialize before you can call GetState");var stateValue=new Microsoft.Xna.Framework.Vector3.ctor;return new Platformer2D.AccelerometerState.$ctor1(stateValue.$clone(),Platformer2D.Accelerometer.isActive)}}}});Bridge.define("Platformer2D.AccelerometerState",{$kind:"struct",statics:{methods:{getDefaultValue:function(){return new Platformer2D.AccelerometerState}}},fields:{Acceleration:null,IsActive:!1},ctors:{init:function(){this.Acceleration=new Microsoft.Xna.Framework.Vector3},$ctor1:function(acceleration,isActive){Platformer2D.AccelerometerState.ctor.call(this);this.Acceleration=acceleration.$clone();this.IsActive=isActive},ctor:function(){this.$initialize()}},methods:{toString:function(){return System.String.format("Acceleration: {0}, IsActive: {1}",this.Acceleration.$clone(),Bridge.box(this.IsActive,System.Boolean,System.Boolean.toString))},getHashCode:function(){return Bridge.addHash([6907946752,this.Acceleration,this.IsActive])},equals:function(o){return Bridge.is(o,Platformer2D.AccelerometerState)?Bridge.equals(this.Acceleration,o.Acceleration)&&Bridge.equals(this.IsActive,o.IsActive):!1},$clone:function(to){var s=to||new Platformer2D.AccelerometerState;return s.Acceleration=this.Acceleration.$clone(),s.IsActive=this.IsActive,s}}});Bridge.define("Platformer2D.Animation",{fields:{texture:null,frameTime:0,isLooping:!1},props:{Texture:{get:function(){return this.texture}},FrameTime:{get:function(){return this.frameTime}},IsLooping:{get:function(){return this.isLooping}},FrameCount:{get:function(){return Bridge.Int.div(this.Texture.Width,this.FrameWidth)|0}},FrameWidth:{get:function(){return this.Texture.Height}},FrameHeight:{get:function(){return this.Texture.Height}}},ctors:{ctor:function(texture,frameTime,isLooping){this.$initialize();this.texture=texture;this.frameTime=frameTime;this.isLooping=isLooping}}});Bridge.define("Platformer2D.AnimationPlayer",{$kind:"struct",statics:{methods:{getDefaultValue:function(){return new Platformer2D.AnimationPlayer}}},fields:{animation:null,frameIndex:0,time:0},props:{Animation:{get:function(){return this.animation}},FrameIndex:{get:function(){return this.frameIndex}},Origin:{get:function(){return new Microsoft.Xna.Framework.Vector2.$ctor2(this.Animation.FrameWidth/2,this.Animation.FrameHeight)}}},ctors:{ctor:function(){this.$initialize()}},methods:{PlayAnimation:function(animation){Bridge.referenceEquals(this.Animation,animation)||(this.animation=animation,this.frameIndex=0,this.time=0)},Draw:function(gameTime,spriteBatch,position,spriteEffects){if(this.Animation==null)throw new System.NotSupportedException.$ctor1("No animation is currently playing.");for(this.time+=gameTime.ElapsedGameTime.getTotalSeconds();this.time>this.Animation.FrameTime;)this.time-=this.Animation.FrameTime,this.frameIndex=this.Animation.IsLooping?(this.frameIndex+1|0)%this.Animation.FrameCount:Math.min(this.frameIndex+1|0,this.Animation.FrameCount-1|0);var source=new Microsoft.Xna.Framework.Rectangle.$ctor2(Bridge.Int.mul(this.FrameIndex,this.Animation.Texture.Height),0,this.Animation.Texture.Height,this.Animation.Texture.Height);spriteBatch.Draw$6(this.Animation.Texture,position.$clone(),source.$clone(),Microsoft.Xna.Framework.Color.White.$clone(),0,this.Origin.$clone(),1,spriteEffects,0)},getHashCode:function(){return Bridge.addHash([5346793609,this.animation,this.frameIndex,this.time])},equals:function(o){return Bridge.is(o,Platformer2D.AnimationPlayer)?Bridge.equals(this.animation,o.animation)&&Bridge.equals(this.frameIndex,o.frameIndex)&&Bridge.equals(this.time,o.time):!1},$clone:function(to){var s=to||new Platformer2D.AnimationPlayer;return s.animation=this.animation,s.frameIndex=this.frameIndex,s.time=this.time,s}}});Bridge.define("Platformer2D.App",{main:function(){var button=document.createElement("button"),brelem,canvas;button.innerHTML="Run Game";document.body.appendChild(button);brelem=document.createElement("br");document.body.appendChild(brelem);canvas=document.createElement("canvas");canvas.width=800;canvas.height=480;canvas.id="monogamecanvas";document.body.appendChild(canvas);button.onclick=function(ev){Platformer2D.App.game=new Platformer2D.PlatformerGame;Platformer2D.App.game.Run();document.body.removeChild(brelem);document.body.removeChild(button)}},statics:{fields:{game:null}}});Bridge.define("Platformer2D.Circle",{$kind:"struct",statics:{methods:{getDefaultValue:function(){return new Platformer2D.Circle}}},fields:{Center:null,Radius:0},ctors:{init:function(){this.Center=new Microsoft.Xna.Framework.Vector2},$ctor1:function(position,radius){this.$initialize();this.Center=position.$clone();this.Radius=radius},ctor:function(){this.$initialize()}},methods:{Intersects:function(rectangle){var v=new Microsoft.Xna.Framework.Vector2.$ctor2(Microsoft.Xna.Framework.MathHelper.Clamp$1(this.Center.X,rectangle.Left,rectangle.Right),Microsoft.Xna.Framework.MathHelper.Clamp$1(this.Center.Y,rectangle.Top,rectangle.Bottom)),direction=Microsoft.Xna.Framework.Vector2.op_Subtraction(this.Center.$clone(),v.$clone()),distanceSquared=direction.LengthSquared();return distanceSquared>0&&distanceSquared<this.Radius*this.Radius},getHashCode:function(){return Bridge.addHash([1668468399,this.Center,this.Radius])},equals:function(o){return Bridge.is(o,Platformer2D.Circle)?Bridge.equals(this.Center,o.Center)&&Bridge.equals(this.Radius,o.Radius):!1},$clone:function(to){var s=to||new Platformer2D.Circle;return s.Center=this.Center.$clone(),s.Radius=this.Radius,s}}});Bridge.define("Platformer2D.Enemy",{statics:{fields:{MaxWaitTime:0,MoveSpeed:0},ctors:{init:function(){this.MaxWaitTime=.5;this.MoveSpeed=64}}},fields:{level:null,position:null,localBounds:null,runAnimation:null,idleAnimation:null,sprite:null,direction:0,waitTime:0},props:{Level:{get:function(){return this.level}},Position:{get:function(){return this.position.$clone()}},BoundingRectangle:{get:function(){var left=Bridge.Int.clip32(Bridge.Math.round(this.Position.X-this.sprite.Origin.X,0,6))+this.localBounds.X|0,top=Bridge.Int.clip32(Bridge.Math.round(this.Position.Y-this.sprite.Origin.Y,0,6))+this.localBounds.Y|0;return new Microsoft.Xna.Framework.Rectangle.$ctor2(left,top,this.localBounds.Width,this.localBounds.Height)}}},ctors:{init:function(){this.position=new Microsoft.Xna.Framework.Vector2;this.localBounds=new Microsoft.Xna.Framework.Rectangle;this.sprite=new Platformer2D.AnimationPlayer;this.direction=Platformer2D.FaceDirection.Left},ctor:function(level,position,spriteSet){this.$initialize();this.level=level;this.position=position.$clone();this.LoadContent(spriteSet)}},methods:{LoadContent:function(spriteSet){this.runAnimation=new Platformer2D.Animation(Platformer2D.GameContent.Texture.MonsterRun[System.Array.index(spriteSet,Platformer2D.GameContent.Texture.MonsterRun)],.1,!0);this.idleAnimation=new Platformer2D.Animation(Platformer2D.GameContent.Texture.MonsterIdle[System.Array.index(spriteSet,Platformer2D.GameContent.Texture.MonsterIdle)],.15,!0);this.sprite.PlayAnimation(this.idleAnimation);var width=Bridge.Int.clip32(this.idleAnimation.FrameWidth*.35),left=Bridge.Int.div(this.idleAnimation.FrameWidth-width|0,2)|0,height=Bridge.Int.clip32(this.idleAnimation.FrameWidth*.7),top=this.idleAnimation.FrameHeight-height|0;this.localBounds=new Microsoft.Xna.Framework.Rectangle.$ctor2(left,top,width,height)},Update:function(gameTime){var elapsed=gameTime.ElapsedGameTime.getTotalSeconds(),posX=this.Position.X+Bridge.Int.mul(Bridge.Int.div(this.localBounds.Width,2)|0,this.direction),tileX=Bridge.Int.clip32(Math.floor(posX/Platformer2D.Tile.Width))-this.direction|0,tileY=Bridge.Int.clip32(Math.floor(this.Position.Y/Platformer2D.Tile.Height)),velocity;this.waitTime>0?(this.waitTime=Math.max(0,this.waitTime-gameTime.ElapsedGameTime.getTotalSeconds()),this.waitTime<=0&&(this.direction=-this.direction|0)):this.Level.GetCollision(tileX+this.direction|0,tileY-1|0)===Platformer2D.TileCollision.Impassable||this.Level.GetCollision(tileX+this.direction|0,tileY)===Platformer2D.TileCollision.Passable?this.waitTime=Platformer2D.Enemy.MaxWaitTime:(velocity=new Microsoft.Xna.Framework.Vector2.$ctor2(this.direction*Platformer2D.Enemy.MoveSpeed*elapsed,0),this.position=Microsoft.Xna.Framework.Vector2.op_Addition(this.position.$clone(),velocity.$clone()))},Draw:function(gameTime,spriteBatch){!this.Level.Player.IsAlive||this.Level.ReachedExit||System.TimeSpan.eq(this.Level.TimeRemaining,System.TimeSpan.zero)||this.waitTime>0?this.sprite.PlayAnimation(this.idleAnimation):this.sprite.PlayAnimation(this.runAnimation);var flip=this.direction>0?Microsoft.Xna.Framework.Graphics.SpriteEffects.FlipHorizontally:Microsoft.Xna.Framework.Graphics.SpriteEffects.None;this.sprite.Draw(gameTime,spriteBatch,this.Position.$clone(),flip)}}});Bridge.define("Platformer2D.FaceDirection",{$kind:"enum",statics:{fields:{Left:-1,Right:1}}});Bridge.define("Platformer2D.GameContent",{statics:{fields:{IsBaseLoaded:!1,IsLoaded:!1,Counter:0,Levels:null},methods:{Init:function(content,graphics){var $step=0,$task1,$taskResult1,$task2,$taskResult2,$task3,$taskResult3,$task4,$taskResult4,$task5,$taskResult5,$task6,$taskResult6,$task7,$taskResult7,$task8,$taskResult8,$task9,$taskResult9,$task10,$taskResult10,$task11,$taskResult11,$task12,$taskResult12,$task13,$taskResult13,$task14,$taskResult14,$task15,$taskResult15,$task16,$taskResult16,$task17,$taskResult17,$task18,$taskResult18,$task19,$taskResult19,$task20,$taskResult20,$task21,$taskResult21,$task22,$taskResult22,$task23,$taskResult23,$task24,$taskResult24,$task25,$taskResult25,$task26,$taskResult26,$task27,$taskResult27,$task28,$taskResult28,$task29,$taskResult29,$task30,$taskResult30,$task31,$taskResult31,$jumpFromFinally,$tcs=new System.Threading.Tasks.TaskCompletionSource,$returnValue,x,y,i,i1,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=System.Array.min([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43],$step);switch($step){case 0:Platformer2D.GameContent.Counter=0;$task1=Microsoft.Xna.Framework.Graphics.Texture2D.FromURL(graphics,"Content/Pixel.png");$step=1;$task1.continueWith($asyncBody);return;case 1:$taskResult1=$task1.getAwaitedResult();Platformer2D.GameContent.Texture.Pixel=$taskResult1;Platformer2D.GameContent.Font.hudFont=content.Load(Microsoft.Xna.Framework.Graphics.SpriteFont,"Fonts/Hud");Platformer2D.GameContent.IsBaseLoaded=!0;$task2=Microsoft.Xna.Framework.Graphics.Texture2D.FromURL(graphics,"Content/Overlays/you_win.png");$step=2;$task2.continueWith($asyncBody);return;case 2:$taskResult2=$task2.getAwaitedResult();Platformer2D.GameContent.Texture.winOverlay=$taskResult2;Platformer2D.GameContent.Counter=Platformer2D.GameContent.Counter+1|0;$task3=Microsoft.Xna.Framework.Graphics.Texture2D.FromURL(graphics,"Content/Overlays/you_lose.png");$step=3;$task3.continueWith($asyncBody);return;case 3:$taskResult3=$task3.getAwaitedResult();Platformer2D.GameContent.Texture.loseOverlay=$taskResult3;Platformer2D.GameContent.Counter=Platformer2D.GameContent.Counter+1|0;$task4=Microsoft.Xna.Framework.Graphics.Texture2D.FromURL(graphics,"Content/Overlays/you_died.png");$step=4;$task4.continueWith($asyncBody);return;case 4:$taskResult4=$task4.getAwaitedResult();Platformer2D.GameContent.Texture.diedOverlay=$taskResult4;Platformer2D.GameContent.Counter=Platformer2D.GameContent.Counter+1|0;$task5=Microsoft.Xna.Framework.Graphics.Texture2D.FromURL(graphics,"Content/Sprites/VirtualControlArrow.png");$step=5;$task5.continueWith($asyncBody);return;case 5:$taskResult5=$task5.getAwaitedResult();Platformer2D.GameContent.Texture.VirtualControlArrow=$taskResult5;Platformer2D.GameContent.Counter=Platformer2D.GameContent.Counter+1|0;$task6=Microsoft.Xna.Framework.Graphics.Texture2D.FromURL(graphics,"Content/Sprites/Player/Idle.png");$step=6;$task6.continueWith($asyncBody);return;case 6:$taskResult6=$task6.getAwaitedResult();Platformer2D.GameContent.Texture.Idle=$taskResult6;Platformer2D.GameContent.Counter=Platformer2D.GameContent.Counter+1|0;$task7=Microsoft.Xna.Framework.Graphics.Texture2D.FromURL(graphics,"Content/Sprites/Player/Run.png");$step=7;$task7.continueWith($asyncBody);return;case 7:$taskResult7=$task7.getAwaitedResult();Platformer2D.GameContent.Texture.Run=$taskResult7;Platformer2D.GameContent.Counter=Platformer2D.GameContent.Counter+1|0;$task8=Microsoft.Xna.Framework.Graphics.Texture2D.FromURL(graphics,"Content/Sprites/Player/Jump.png");$step=8;$task8.continueWith($asyncBody);return;case 8:$taskResult8=$task8.getAwaitedResult();Platformer2D.GameContent.Texture.Jump=$taskResult8;Platformer2D.GameContent.Counter=Platformer2D.GameContent.Counter+1|0;$task9=Microsoft.Xna.Framework.Graphics.Texture2D.FromURL(graphics,"Content/Sprites/Player/Celebrate.png");$step=9;$task9.continueWith($asyncBody);return;case 9:$taskResult9=$task9.getAwaitedResult();Platformer2D.GameContent.Texture.Celebrate=$taskResult9;Platformer2D.GameContent.Counter=Platformer2D.GameContent.Counter+1|0;$task10=Microsoft.Xna.Framework.Graphics.Texture2D.FromURL(graphics,"Content/Sprites/Player/Die.png");$step=10;$task10.continueWith($asyncBody);return;case 10:$taskResult10=$task10.getAwaitedResult();Platformer2D.GameContent.Texture.Die=$taskResult10;Platformer2D.GameContent.Counter=Platformer2D.GameContent.Counter+1|0;$task11=Microsoft.Xna.Framework.Graphics.Texture2D.FromURL(graphics,"Content/Sprites/Gem.png");$step=11;$task11.continueWith($asyncBody);return;case 11:$taskResult11=$task11.getAwaitedResult();Platformer2D.GameContent.Texture.Gem=$taskResult11;Platformer2D.GameContent.Counter=Platformer2D.GameContent.Counter+1|0;Platformer2D.GameContent.Texture.BackgroundLayer=System.Array.create(null,null,Microsoft.Xna.Framework.Graphics.Texture2D,3,3);x=0;$step=12;continue;case 12:if(x<3){$step=13;continue}$step=20;continue;case 13:y=0;$step=14;continue;case 14:if(y<3){$step=15;continue}$step=18;continue;case 15:$task12=Microsoft.Xna.Framework.Graphics.Texture2D.FromURL(graphics,"Content/Backgrounds/Layer"+x+"_"+y+".png");$step=16;$task12.continueWith($asyncBody);return;case 16:$taskResult12=$task12.getAwaitedResult();Platformer2D.GameContent.Texture.BackgroundLayer.set([x,y],$taskResult12);Platformer2D.GameContent.Counter=Platformer2D.GameContent.Counter+1|0;$step=17;continue;case 17:y=y+1|0;$step=14;continue;case 19:x=x+1|0;$step=12;continue;case 20:Platformer2D.GameContent.Texture.MonsterIdle=System.Array.init(4,null,Microsoft.Xna.Framework.Graphics.Texture2D);Platformer2D.GameContent.Texture.MonsterRun=System.Array.init(4,null,Microsoft.Xna.Framework.Graphics.Texture2D);i=0;$step=21;continue;case 21:if(i<4){$step=22;continue}$step=26;continue;case 22:$task13=Microsoft.Xna.Framework.Graphics.Texture2D.FromURL(graphics,"Content/Sprites/Monster"+i+"/Idle.png");$step=23;$task13.continueWith($asyncBody);return;case 23:$taskResult13=$task13.getAwaitedResult();Platformer2D.GameContent.Texture.MonsterIdle[System.Array.index(i,Platformer2D.GameContent.Texture.MonsterIdle)]=$taskResult13;Platformer2D.GameContent.Counter=Platformer2D.GameContent.Counter+1|0;$task14=Microsoft.Xna.Framework.Graphics.Texture2D.FromURL(graphics,"Content/Sprites/Monster"+i+"/Run.png");$step=24;$task14.continueWith($asyncBody);return;case 24:$taskResult14=$task14.getAwaitedResult();Platformer2D.GameContent.Texture.MonsterRun[System.Array.index(i,Platformer2D.GameContent.Texture.MonsterRun)]=$taskResult14;Platformer2D.GameContent.Counter=Platformer2D.GameContent.Counter+1|0;$step=25;continue;case 25:i=i+1|0;$step=21;continue;case 26:Platformer2D.GameContent.Texture.Tiles=new(System.Collections.Generic.Dictionary$2(System.String,Microsoft.Xna.Framework.Graphics.Texture2D));$task15=Microsoft.Xna.Framework.Graphics.Texture2D.FromURL(graphics,"Content/Tiles/BlockA0.png");$step=27;$task15.continueWith($asyncBody);return;case 27:$taskResult15=$task15.getAwaitedResult();Platformer2D.GameContent.Texture.Tiles.set("BlockA0",$taskResult15);Platformer2D.GameContent.Counter=Platformer2D.GameContent.Counter+1|0;$task16=Microsoft.Xna.Framework.Graphics.Texture2D.FromURL(graphics,"Content/Tiles/BlockA1.png");$step=28;$task16.continueWith($asyncBody);return;case 28:$taskResult16=$task16.getAwaitedResult();Platformer2D.GameContent.Texture.Tiles.set("BlockA1",$taskResult16);Platformer2D.GameContent.Counter=Platformer2D.GameContent.Counter+1|0;$task17=Microsoft.Xna.Framework.Graphics.Texture2D.FromURL(graphics,"Content/Tiles/BlockA2.png");$step=29;$task17.continueWith($asyncBody);return;case 29:$taskResult17=$task17.getAwaitedResult();Platformer2D.GameContent.Texture.Tiles.set("BlockA2",$taskResult17);Platformer2D.GameContent.Counter=Platformer2D.GameContent.Counter+1|0;$task18=Microsoft.Xna.Framework.Graphics.Texture2D.FromURL(graphics,"Content/Tiles/BlockA3.png");$step=30;$task18.continueWith($asyncBody);return;case 30:$taskResult18=$task18.getAwaitedResult();Platformer2D.GameContent.Texture.Tiles.set("BlockA3",$taskResult18);Platformer2D.GameContent.Counter=Platformer2D.GameContent.Counter+1|0;$task19=Microsoft.Xna.Framework.Graphics.Texture2D.FromURL(graphics,"Content/Tiles/BlockA4.png");$step=31;$task19.continueWith($asyncBody);return;case 31:$taskResult19=$task19.getAwaitedResult();Platformer2D.GameContent.Texture.Tiles.set("BlockA4",$taskResult19);Platformer2D.GameContent.Counter=Platformer2D.GameContent.Counter+1|0;$task20=Microsoft.Xna.Framework.Graphics.Texture2D.FromURL(graphics,"Content/Tiles/BlockA5.png");$step=32;$task20.continueWith($asyncBody);return;case 32:$taskResult20=$task20.getAwaitedResult();Platformer2D.GameContent.Texture.Tiles.set("BlockA5",$taskResult20);Platformer2D.GameContent.Counter=Platformer2D.GameContent.Counter+1|0;$task21=Microsoft.Xna.Framework.Graphics.Texture2D.FromURL(graphics,"Content/Tiles/BlockA6.png");$step=33;$task21.continueWith($asyncBody);return;case 33:$taskResult21=$task21.getAwaitedResult();Platformer2D.GameContent.Texture.Tiles.set("BlockA6",$taskResult21);Platformer2D.GameContent.Counter=Platformer2D.GameContent.Counter+1|0;$task22=Microsoft.Xna.Framework.Graphics.Texture2D.FromURL(graphics,"Content/Tiles/BlockB0.png");$step=34;$task22.continueWith($asyncBody);return;case 34:$taskResult22=$task22.getAwaitedResult();Platformer2D.GameContent.Texture.Tiles.set("BlockB0",$taskResult22);Platformer2D.GameContent.Counter=Platformer2D.GameContent.Counter+1|0;$task23=Microsoft.Xna.Framework.Graphics.Texture2D.FromURL(graphics,"Content/Tiles/BlockB1.png");$step=35;$task23.continueWith($asyncBody);return;case 35:$taskResult23=$task23.getAwaitedResult();Platformer2D.GameContent.Texture.Tiles.set("BlockB1",$taskResult23);Platformer2D.GameContent.Counter=Platformer2D.GameContent.Counter+1|0;$task24=Microsoft.Xna.Framework.Graphics.Texture2D.FromURL(graphics,"Content/Tiles/Exit.png");$step=36;$task24.continueWith($asyncBody);return;case 36:$taskResult24=$task24.getAwaitedResult();Platformer2D.GameContent.Texture.Tiles.set("Exit",$taskResult24);Platformer2D.GameContent.Counter=Platformer2D.GameContent.Counter+1|0;$task25=Microsoft.Xna.Framework.Graphics.Texture2D.FromURL(graphics,"Content/Tiles/Platform.png");$step=37;$task25.continueWith($asyncBody);return;case 37:$taskResult25=$task25.getAwaitedResult();Platformer2D.GameContent.Texture.Tiles.set("Platform",$taskResult25);Platformer2D.GameContent.Counter=Platformer2D.GameContent.Counter+1|0;$task26=Microsoft.Xna.Framework.Media.Song.FromURL("Content/Sounds/Music.ogg");$step=38;$task26.continueWith($asyncBody);return;case 38:$taskResult26=$task26.getAwaitedResult();Platformer2D.GameContent.Songs.Music=$taskResult26;Platformer2D.GameContent.Counter=Platformer2D.GameContent.Counter+1|0;$task27=Microsoft.Xna.Framework.Audio.SoundEffect.FromURL("Content/Sounds/PlayerKilled.wav");$step=39;$task27.continueWith($asyncBody);return;case 39:$taskResult27=$task27.getAwaitedResult();Platformer2D.GameContent.SoundEffects.killedSound=$taskResult27;Platformer2D.GameContent.Counter=Platformer2D.GameContent.Counter+1|0;$task28=Microsoft.Xna.Framework.Audio.SoundEffect.FromURL("Content/Sounds/PlayerJump.wav");$step=40;$task28.continueWith($asyncBody);return;case 40:$taskResult28=$task28.getAwaitedResult();Platformer2D.GameContent.SoundEffects.jumpSound=$taskResult28;Platformer2D.GameContent.Counter=Platformer2D.GameContent.Counter+1|0;$task29=Microsoft.Xna.Framework.Audio.SoundEffect.FromURL("Content/Sounds/PlayerFall.wav");$step=41;$task29.continueWith($asyncBody);return;case 41:$taskResult29=$task29.getAwaitedResult();Platformer2D.GameContent.SoundEffects.fallSound=$taskResult29;Platformer2D.GameContent.Counter=Platformer2D.GameContent.Counter+1|0;$task30=Microsoft.Xna.Framework.Audio.SoundEffect.FromURL("Content/Sounds/ExitReached.wav");$step=42;$task30.continueWith($asyncBody);return;case 42:$taskResult30=$task30.getAwaitedResult();Platformer2D.GameContent.SoundEffects.exitReachedSound=$taskResult30;Platformer2D.GameContent.Counter=Platformer2D.GameContent.Counter+1|0;$task31=Microsoft.Xna.Framework.Audio.SoundEffect.FromURL("Content/Sounds/GemCollected.wav");$step=43;$task31.continueWith($asyncBody);return;case 43:for($taskResult31=$task31.getAwaitedResult(),Platformer2D.GameContent.SoundEffects.collectedSound=$taskResult31,Platformer2D.GameContent.Counter=Platformer2D.GameContent.Counter+1|0,Platformer2D.GameContent.Levels=new(System.Collections.Generic.List$1(System.Array.type(System.String)).ctor),i1=0;i1<3;i1=i1+1|0)Platformer2D.GameContent.Levels.add(System.IO.File.ReadAllLines("Content/Levels/"+i1+".txt")),Platformer2D.GameContent.Counter=Platformer2D.GameContent.Counter+1|0;Platformer2D.GameContent.IsLoaded=!0;$tcs.setResult(null);return;default:$tcs.setResult(null);return}}}catch($async_e1){$async_e=System.Exception.create($async_e1);$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task}}}});Bridge.define("Platformer2D.GameContent.Font",{$kind:"nested class",statics:{fields:{hudFont:null}}});Bridge.define("Platformer2D.GameContent.Songs",{$kind:"nested class",statics:{fields:{Music:null}}});Bridge.define("Platformer2D.GameContent.SoundEffects",{$kind:"nested class",statics:{fields:{killedSound:null,jumpSound:null,fallSound:null,exitReachedSound:null,collectedSound:null}}});Bridge.define("Platformer2D.GameContent.Texture",{$kind:"nested class",statics:{fields:{winOverlay:null,loseOverlay:null,diedOverlay:null,Pixel:null,VirtualControlArrow:null,Idle:null,Run:null,Jump:null,Celebrate:null,Die:null,Gem:null,BackgroundLayer:null,MonsterRun:null,MonsterIdle:null,Tiles:null}}});Bridge.define("Platformer2D.Gem",{statics:{fields:{PointValue:0},ctors:{init:function(){this.PointValue=30}}},fields:{origin:null,Color:null,basePosition:null,bounce:0,level:null},props:{Level:{get:function(){return this.level}},Position:{get:function(){return Microsoft.Xna.Framework.Vector2.op_Addition(this.basePosition.$clone(),new Microsoft.Xna.Framework.Vector2.$ctor2(0,this.bounce))}},BoundingCircle:{get:function(){return new Platformer2D.Circle.$ctor1(this.Position.$clone(),13.333333)}}},ctors:{init:function(){this.origin=new Microsoft.Xna.Framework.Vector2;this.Color=new Microsoft.Xna.Framework.Color;this.basePosition=new Microsoft.Xna.Framework.Vector2;this.Color=Microsoft.Xna.Framework.Color.Yellow.$clone()},ctor:function(level,position){this.$initialize();this.level=level;this.basePosition=position.$clone();this.LoadContent()}},methods:{LoadContent:function(){this.origin=new Microsoft.Xna.Framework.Vector2.$ctor2(Platformer2D.GameContent.Texture.Gem.Width/2,Platformer2D.GameContent.Texture.Gem.Height/2)},Update:function(gameTime){var BounceHeight=.18,BounceRate=3,BounceSync=-.75,t=gameTime.TotalGameTime.getTotalSeconds()*BounceRate+this.Position.X*BounceSync;this.bounce=Math.sin(t)*BounceHeight*Platformer2D.GameContent.Texture.Gem.Height},OnCollected:function(collectedBy){Platformer2D.GameContent.SoundEffects.collectedSound.Play()},Draw:function(gameTime,spriteBatch){spriteBatch.Draw$6(Platformer2D.GameContent.Texture.Gem,this.Position.$clone(),null,this.Color.$clone(),0,this.origin.$clone(),1,Microsoft.Xna.Framework.Graphics.SpriteEffects.None,0)}}});Bridge.define("Platformer2D.Level",{inherits:[System.IDisposable],statics:{fields:{EntityLayer:0,InvalidPosition:null,PointsPerSecond:0},ctors:{init:function(){this.InvalidPosition=new Microsoft.Xna.Framework.Point;this.EntityLayer=2;this.InvalidPosition=new Microsoft.Xna.Framework.Point.$ctor2(-1,-1);this.PointsPerSecond=5}}},fields:{tiles:null,layers:null,player:null,gems:null,enemies:null,start:null,exit:null,random:null,score:0,reachedExit:!1,timeRemaining:null},props:{Player:{get:function(){return this.player}},Score:{get:function(){return this.score}},ReachedExit:{get:function(){return this.reachedExit}},TimeRemaining:{get:function(){return this.timeRemaining}},Width:{get:function(){return System.Array.getLength(this.tiles,0)}},Height:{get:function(){return System.Array.getLength(this.tiles,1)}}},alias:["Dispose","System$IDisposable$Dispose"],ctors:{init:function(){this.start=new Microsoft.Xna.Framework.Vector2;this.exit=new Microsoft.Xna.Framework.Point;this.timeRemaining=new System.TimeSpan;this.gems=new(System.Collections.Generic.List$1(Platformer2D.Gem).ctor);this.enemies=new(System.Collections.Generic.List$1(Platformer2D.Enemy).ctor);this.exit=Platformer2D.Level.InvalidPosition.$clone();this.random=new System.Random.$ctor1(354668)},ctor:function(levelIndex){var i,segmentIndex;for(this.$initialize(),this.timeRemaining=System.TimeSpan.fromMinutes(2),this.LoadTiles(levelIndex),this.layers=System.Array.init(3,null,Microsoft.Xna.Framework.Graphics.Texture2D),i=0;i<this.layers.length;i=i+1|0)segmentIndex=levelIndex,this.layers[System.Array.index(i,this.layers)]=Platformer2D.GameContent.Texture.BackgroundLayer.get([i,segmentIndex])}},methods:{LoadTiles:function(levelIndex){var lines=Platformer2D.GameContent.Levels.getItem(levelIndex),y,x,tileType;for(this.tiles=System.Array.create(function(){return new Platformer2D.Tile},null,Platformer2D.Tile,lines[System.Array.index(0,lines)].length,lines.length),y=0;y<this.Height;y=y+1|0)for(x=0;x<this.Width;x=x+1|0)tileType=lines[System.Array.index(y,lines)].charCodeAt(x),this.tiles.set([x,y],this.LoadTile(tileType,x,y));if(this.Player==null)throw new System.NotSupportedException.$ctor1("A level must have a starting point.");if(Microsoft.Xna.Framework.Point.op_Equality(this.exit.$clone(),Platformer2D.Level.InvalidPosition.$clone()))throw new System.NotSupportedException.$ctor1("A level must have an exit.");},LoadTile:function(tileType,x,y){switch(tileType){case 46:return new Platformer2D.Tile.$ctor1(null,Platformer2D.TileCollision.Passable);case 88:return this.LoadExitTile(x,y);case 71:return this.LoadGemTile(x,y);case 45:return this.LoadTile$1("Platform",Platformer2D.TileCollision.Platform);case 65:return this.LoadEnemyTile(x,y,0);case 66:return this.LoadEnemyTile(x,y,1);case 67:return this.LoadEnemyTile(x,y,2);case 68:return this.LoadEnemyTile(x,y,3);case 126:return this.LoadVarietyTile("BlockB",2,Platformer2D.TileCollision.Platform);case 58:return this.LoadVarietyTile("BlockB",2,Platformer2D.TileCollision.Passable);case 49:return this.LoadStartTile(x,y);case 35:return this.LoadVarietyTile("BlockA",7,Platformer2D.TileCollision.Impassable);default:throw new System.NotSupportedException.$ctor1(System.String.format("Unsupported tile type character '{0}' at position {1}, {2}.",Bridge.box(tileType,System.Char,String.fromCharCode,System.Char.getHashCode),Bridge.box(x,System.Int32),Bridge.box(y,System.Int32)));}},LoadTile$1:function(name,collision){return new Platformer2D.Tile.$ctor1(Platformer2D.GameContent.Texture.Tiles.get(name),collision)},LoadVarietyTile:function(baseName,variationCount,collision){var index=this.random.Next$1(variationCount);return this.LoadTile$1((baseName||"")+index,collision)},LoadStartTile:function(x,y){if(this.Player!=null)throw new System.NotSupportedException.$ctor1("A level may only have one starting point.");return this.start=Platformer2D.RectangleExtensions.GetBottomCenter(this.GetBounds(x,y)),this.player=new Platformer2D.Player(this,this.start.$clone()),new Platformer2D.Tile.$ctor1(null,Platformer2D.TileCollision.Passable)},LoadExitTile:function(x,y){if(Microsoft.Xna.Framework.Point.op_Inequality(this.exit.$clone(),Platformer2D.Level.InvalidPosition.$clone()))throw new System.NotSupportedException.$ctor1("A level may only have one exit.");return this.exit=this.GetBounds(x,y).Center.$clone(),this.LoadTile$1("Exit",Platformer2D.TileCollision.Passable)},LoadEnemyTile:function(x,y,spriteSet){var position=Platformer2D.RectangleExtensions.GetBottomCenter(this.GetBounds(x,y));return this.enemies.add(new Platformer2D.Enemy(this,position.$clone(),spriteSet)),new Platformer2D.Tile.$ctor1(null,Platformer2D.TileCollision.Passable)},LoadGemTile:function(x,y){var position=this.GetBounds(x,y).Center.$clone();return this.gems.add(new Platformer2D.Gem(this,new Microsoft.Xna.Framework.Vector2.$ctor2(position.X,position.Y))),new Platformer2D.Tile.$ctor1(null,Platformer2D.TileCollision.Passable)},Dispose:function(){},GetCollision:function(x,y){return x<0||x>=this.Width?Platformer2D.TileCollision.Impassable:y<0||y>=this.Height?Platformer2D.TileCollision.Passable:this.tiles.get([x,y]).Collision},GetBounds:function(x,y){return new Microsoft.Xna.Framework.Rectangle.$ctor2(Bridge.Int.mul(x,Platformer2D.Tile.Width),Bridge.Int.mul(y,Platformer2D.Tile.Height),Platformer2D.Tile.Width,Platformer2D.Tile.Height)},Update:function(gameTime,keyboardState,gamePadState,accelState,orientation){if(!this.Player.IsAlive||System.TimeSpan.eq(this.TimeRemaining,System.TimeSpan.zero))this.Player.ApplyPhysics(gameTime);else if(this.ReachedExit){var seconds=Bridge.Int.clip32(Bridge.Math.round(gameTime.ElapsedGameTime.getTotalSeconds()*100,0,6));seconds=Math.min(seconds,Bridge.Int.clip32(Math.ceil(this.TimeRemaining.getTotalSeconds())));this.timeRemaining=System.TimeSpan.sub(this.timeRemaining,System.TimeSpan.fromSeconds(seconds));this.score=this.score+Bridge.Int.mul(seconds,Platformer2D.Level.PointsPerSecond)|0}else this.timeRemaining=System.TimeSpan.sub(this.timeRemaining,gameTime.ElapsedGameTime),this.Player.Update(gameTime,keyboardState.$clone(),gamePadState.$clone(),accelState.$clone(),orientation),this.UpdateGems(gameTime),this.Player.BoundingRectangle.Top>=Bridge.Int.mul(this.Height,Platformer2D.Tile.Height)&&this.OnPlayerKilled(null),this.UpdateEnemies(gameTime),this.Player.IsAlive&&this.Player.IsOnGround&&this.Player.BoundingRectangle.Contains(this.exit.$clone())&&this.OnExitReached();System.TimeSpan.lt(this.timeRemaining,System.TimeSpan.zero)&&(this.timeRemaining=System.TimeSpan.zero)},UpdateGems:function(gameTime){for(var gem,i=0;i<this.gems.Count;i=i+1|0)gem=this.gems.getItem(i),gem.Update(gameTime),gem.BoundingCircle.Intersects(this.Player.BoundingRectangle.$clone())&&(this.gems.removeAt(Bridge.identity(i,i=i-1|0)),this.OnGemCollected(gem,this.Player))},UpdateEnemies:function(gameTime){var $t,enemy;$t=Bridge.getEnumerator(this.enemies);try{while($t.moveNext())enemy=$t.Current,enemy.Update(gameTime),enemy.BoundingRectangle.Intersects(this.Player.BoundingRectangle.$clone())&&this.OnPlayerKilled(enemy)}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$Dispose()}},OnGemCollected:function(gem,collectedBy){this.score=this.score+Platformer2D.Gem.PointValue|0;gem.OnCollected(collectedBy)},OnPlayerKilled:function(killedBy){this.Player.OnKilled(killedBy)},OnExitReached:function(){this.Player.OnReachedExit();Platformer2D.GameContent.SoundEffects.exitReachedSound.Play();this.reachedExit=!0},StartNewLife:function(){this.Player.Reset(this.start.$clone())},Draw:function(gameTime,spriteBatch){for(var gem,enemy,i1,$t,$t1,i=0;i<=Platformer2D.Level.EntityLayer;i=i+1|0)spriteBatch.Draw$3(this.layers[System.Array.index(i,this.layers)],Microsoft.Xna.Framework.Vector2.Zero.$clone(),Microsoft.Xna.Framework.Color.White.$clone());this.DrawTiles(spriteBatch);$t=Bridge.getEnumerator(this.gems);try{while($t.moveNext())gem=$t.Current,gem.Draw(gameTime,spriteBatch)}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$Dispose()}this.Player.Draw(gameTime,spriteBatch);$t1=Bridge.getEnumerator(this.enemies);try{while($t1.moveNext())enemy=$t1.Current,enemy.Draw(gameTime,spriteBatch)}finally{Bridge.is($t1,System.IDisposable)&&$t1.System$IDisposable$Dispose()}for(i1=3;i1<this.layers.length;i1=i1+1|0)spriteBatch.Draw$3(this.layers[System.Array.index(i1,this.layers)],Microsoft.Xna.Framework.Vector2.Zero.$clone(),Microsoft.Xna.Framework.Color.White.$clone())},DrawTiles:function(spriteBatch){for(var x,texture,position,y=0;y<this.Height;y=y+1|0)for(x=0;x<this.Width;x=x+1|0)texture=this.tiles.get([x,y]).Texture,texture!=null&&(position=Microsoft.Xna.Framework.Vector2.op_Multiply(new Microsoft.Xna.Framework.Vector2.$ctor2(x,y),Platformer2D.Tile.Size.$clone()),spriteBatch.Draw$3(texture,position.$clone(),Microsoft.Xna.Framework.Color.White.$clone()))}}});Bridge.define("Platformer2D.PlatformerGame",{inherits:[Microsoft.Xna.Framework.Game],statics:{fields:{WarningTime:null,numberOfLevels:0},ctors:{init:function(){this.WarningTime=new System.TimeSpan;this.WarningTime=System.TimeSpan.fromSeconds(30);this.numberOfLevels=3}}},fields:{graphics:null,spriteBatch:null,baseScreenSize:null,globalTransformation:null,levelIndex:0,level:null,wasContinuePressed:!1,gamePadState:null,keyboardState:null,touchState:null,accelerometerState:null,virtualGamePad:null},ctors:{init:function(){this.baseScreenSize=new Microsoft.Xna.Framework.Vector2;this.globalTransformation=new Microsoft.Xna.Framework.Matrix;this.gamePadState=new Microsoft.Xna.Framework.Input.GamePadState;this.keyboardState=new Microsoft.Xna.Framework.Input.KeyboardState;this.touchState=new Microsoft.Xna.Framework.Input.Touch.TouchCollection;this.accelerometerState=new Platformer2D.AccelerometerState;this.baseScreenSize=new Microsoft.Xna.Framework.Vector2.$ctor2(800,480);this.levelIndex=-1},ctor:function(){this.$initialize();Microsoft.Xna.Framework.Game.ctor.call(this);this.graphics=new Microsoft.Xna.Framework.GraphicsDeviceManager(this);this.Content.RootDirectory="Content";this.graphics.HardwareModeSwitch=!1;this.graphics.SupportedOrientations=3;Platformer2D.Accelerometer.Initialize()}},methods:{LoadContent:function(){this.spriteBatch=new Microsoft.Xna.Framework.Graphics.SpriteBatch(this.GraphicsDevice);this.LoadStuff()},LoadStuff:function(){var $step=0,$task1,$jumpFromFinally,horScaling,verScaling,screenScalingFactor,$asyncBody=Bridge.fn.bind(this,function(){for(;;){$step=System.Array.min([0,1],$step);switch($step){case 0:$task1=Platformer2D.GameContent.Init(this.Content,this.GraphicsDevice);$step=1;$task1.continueWith($asyncBody,!0);return;case 1:$task1.getAwaitedResult();horScaling=this.GraphicsDevice.PresentationParameters.BackBufferWidth/this.baseScreenSize.X;verScaling=this.GraphicsDevice.PresentationParameters.BackBufferHeight/this.baseScreenSize.Y;screenScalingFactor=new Microsoft.Xna.Framework.Vector3.$ctor3(horScaling,verScaling,1);this.globalTransformation=Microsoft.Xna.Framework.Matrix.CreateScale(screenScalingFactor.$clone());this.virtualGamePad=new Platformer2D.VirtualGamePad(this.baseScreenSize.$clone(),this.globalTransformation.$clone(),Platformer2D.GameContent.Texture.VirtualControlArrow);Microsoft.Xna.Framework.Media.MediaPlayer.IsRepeating=!0;Microsoft.Xna.Framework.Media.MediaPlayer.Play(Platformer2D.GameContent.Songs.Music);this.LoadNextLevel();return;default:return}}},arguments);$asyncBody()},Update:function(gameTime){Platformer2D.GameContent.IsLoaded&&(this.HandleInput(gameTime),this.level.Update(gameTime,this.keyboardState.$clone(),this.gamePadState.$clone(),this.accelerometerState.$clone(),this.Window.CurrentOrientation),Microsoft.Xna.Framework.Vector2.op_Inequality(this.level.Player.Velocity.$clone(),Microsoft.Xna.Framework.Vector2.Zero.$clone())&&this.virtualGamePad.NotifyPlayerIsMoving(),Microsoft.Xna.Framework.Game.prototype.Update.call(this,gameTime))},HandleInput:function(gameTime){this.keyboardState=Microsoft.Xna.Framework.Input.Keyboard.GetState();this.touchState=Microsoft.Xna.Framework.Input.Touch.TouchPanel.GetState();this.gamePadState=this.virtualGamePad.GetState(this.touchState,Microsoft.Xna.Framework.Input.GamePad.GetState(Microsoft.Xna.Framework.PlayerIndex.One));this.accelerometerState=Platformer2D.Accelerometer.GetState();this.gamePadState.Buttons.Back===Microsoft.Xna.Framework.Input.ButtonState.Pressed&&this.Exit();var continuePressed=this.keyboardState.IsKeyDown(Microsoft.Xna.Framework.Input.Keys.Space)||this.gamePadState.IsButtonDown(Microsoft.Xna.Framework.Input.Buttons.A)||Platformer2D.TouchCollectionExtensions.AnyTouch(this.touchState);!this.wasContinuePressed&&continuePressed&&(this.level.Player.IsAlive?System.TimeSpan.eq(this.level.TimeRemaining,System.TimeSpan.zero)&&(this.level.ReachedExit?this.LoadNextLevel():this.ReloadCurrentLevel()):this.level.StartNewLife());this.wasContinuePressed=continuePressed;this.virtualGamePad.Update(gameTime)},LoadNextLevel:function(){this.levelIndex=(this.levelIndex+1|0)%Platformer2D.PlatformerGame.numberOfLevels;this.level!=null&&this.level.Dispose();this.level=new Platformer2D.Level(this.levelIndex)},ReloadCurrentLevel:function(){this.levelIndex=this.levelIndex-1|0;this.LoadNextLevel()},Draw:function(gameTime){if(!Platformer2D.GameContent.IsLoaded){this.graphics.GraphicsDevice.Clear(Microsoft.Xna.Framework.Color.CornflowerBlue.$clone());Platformer2D.GameContent.IsBaseLoaded&&(this.spriteBatch.Begin(),this.spriteBatch.DrawString(Platformer2D.GameContent.Font.hudFont,"Platformer2D is loading: "+Platformer2D.GameContent.Counter+" / 47",new Microsoft.Xna.Framework.Vector2.$ctor2(20,430-Platformer2D.GameContent.Font.hudFont.MeasureString("C").Y),Microsoft.Xna.Framework.Color.White.$clone()),this.spriteBatch.Draw(Platformer2D.GameContent.Texture.Pixel,new Microsoft.Xna.Framework.Rectangle.$ctor2(20,440,Bridge.Int.clip32(760*(Platformer2D.GameContent.Counter/47)),20),Microsoft.Xna.Framework.Color.White.$clone()),this.spriteBatch.End());return}this.graphics.GraphicsDevice.Clear(Microsoft.Xna.Framework.Color.CornflowerBlue.$clone());this.spriteBatch.Begin(Microsoft.Xna.Framework.Graphics.SpriteSortMode.Immediate,null,null,null,null,null,this.globalTransformation.$clone());this.level.Draw(gameTime,this.spriteBatch);this.DrawHud();this.spriteBatch.End();Microsoft.Xna.Framework.Game.prototype.Draw.call(this,gameTime)},DrawHud:function(){var titleSafeArea=this.GraphicsDevice.Viewport.TitleSafeArea.$clone(),hudLocation=new Microsoft.Xna.Framework.Vector2.$ctor2(titleSafeArea.X,titleSafeArea.Y),center=new Microsoft.Xna.Framework.Vector2.$ctor2(this.baseScreenSize.X/2,this.baseScreenSize.Y/2),timeString="TIME: "+(System.Int32.format(this.level.TimeRemaining.getMinutes(),"00")||"")+":"+(System.Int32.format(this.level.TimeRemaining.getSeconds(),"00")||""),timeColor=new Microsoft.Xna.Framework.Color,timeHeight,status,statusSize;timeColor=System.TimeSpan.gt(this.level.TimeRemaining,Platformer2D.PlatformerGame.WarningTime)||this.level.ReachedExit||Bridge.Int.clip32(this.level.TimeRemaining.getTotalSeconds())%2==0?Microsoft.Xna.Framework.Color.Yellow.$clone():Microsoft.Xna.Framework.Color.Red.$clone();this.DrawShadowedString(Platformer2D.GameContent.Font.hudFont,timeString,hudLocation.$clone(),timeColor.$clone());timeHeight=Platformer2D.GameContent.Font.hudFont.MeasureString(timeString).Y;this.DrawShadowedString(Platformer2D.GameContent.Font.hudFont,"SCORE: "+(Bridge.toString(this.level.Score)||""),Microsoft.Xna.Framework.Vector2.op_Addition(hudLocation.$clone(),new Microsoft.Xna.Framework.Vector2.$ctor2(0,timeHeight*1.2)),Microsoft.Xna.Framework.Color.Yellow.$clone());status=null;System.TimeSpan.eq(this.level.TimeRemaining,System.TimeSpan.zero)?status=this.level.ReachedExit?Platformer2D.GameContent.Texture.winOverlay:Platformer2D.GameContent.Texture.loseOverlay:this.level.Player.IsAlive||(status=Platformer2D.GameContent.Texture.diedOverlay);status!=null&&(statusSize=new Microsoft.Xna.Framework.Vector2.$ctor2(status.Width,status.Height),this.spriteBatch.Draw$3(status,Microsoft.Xna.Framework.Vector2.op_Subtraction(center.$clone(),Microsoft.Xna.Framework.Vector2.op_Division$1(statusSize.$clone(),2)),Microsoft.Xna.Framework.Color.White.$clone()));this.touchState.IsConnected&&this.virtualGamePad.Draw(this.spriteBatch)},DrawShadowedString:function(font,value,position,color){this.spriteBatch.DrawString(font,value,Microsoft.Xna.Framework.Vector2.op_Addition(position.$clone(),new Microsoft.Xna.Framework.Vector2.$ctor2(1,1)),Microsoft.Xna.Framework.Color.Black.$clone());this.spriteBatch.DrawString(font,value,position.$clone(),color.$clone())}}});Bridge.define("Platformer2D.Player",{statics:{fields:{MoveAcceleration:0,MaxMoveSpeed:0,GroundDragFactor:0,AirDragFactor:0,MaxJumpTime:0,JumpLaunchVelocity:0,GravityAcceleration:0,MaxFallSpeed:0,JumpControlPower:0,MoveStickScale:0,AccelerometerScale:0,JumpButton:0},ctors:{init:function(){this.MoveAcceleration=13e3;this.MaxMoveSpeed=1750;this.GroundDragFactor=.48;this.AirDragFactor=.58;this.MaxJumpTime=.35;this.JumpLaunchVelocity=-3500;this.GravityAcceleration=3400;this.MaxFallSpeed=550;this.JumpControlPower=.14;this.MoveStickScale=1;this.AccelerometerScale=1.5;this.JumpButton=Microsoft.Xna.Framework.Input.Buttons.A}}},fields:{idleAnimation:null,runAnimation:null,jumpAnimation:null,celebrateAnimation:null,dieAnimation:null,flip:0,sprite:null,level:null,isAlive:!1,position:null,previousBottom:0,velocity:null,isOnGround:!1,movement:0,isJumping:!1,wasJumping:!1,jumpTime:0,localBounds:null},props:{Level:{get:function(){return this.level}},IsAlive:{get:function(){return this.isAlive}},Position:{get:function(){return this.position.$clone()},set:function(value){this.position=value.$clone()}},Velocity:{get:function(){return this.velocity.$clone()},set:function(value){this.velocity=value.$clone()}},IsOnGround:{get:function(){return this.isOnGround}},BoundingRectangle:{get:function(){var left=Bridge.Int.clip32(Bridge.Math.round(this.Position.X-this.sprite.Origin.X,0,6))+this.localBounds.X|0,top=Bridge.Int.clip32(Bridge.Math.round(this.Position.Y-this.sprite.Origin.Y,0,6))+this.localBounds.Y|0;return new Microsoft.Xna.Framework.Rectangle.$ctor2(left,top,this.localBounds.Width,this.localBounds.Height)}}},ctors:{init:function(){this.sprite=new Platformer2D.AnimationPlayer;this.position=new Microsoft.Xna.Framework.Vector2;this.velocity=new Microsoft.Xna.Framework.Vector2;this.localBounds=new Microsoft.Xna.Framework.Rectangle;this.flip=Microsoft.Xna.Framework.Graphics.SpriteEffects.None},ctor:function(level,position){this.$initialize();this.level=level;this.LoadContent();this.Reset(position.$clone())}},methods:{LoadContent:function(){this.idleAnimation=new Platformer2D.Animation(Platformer2D.GameContent.Texture.Idle,.1,!0);this.runAnimation=new Platformer2D.Animation(Platformer2D.GameContent.Texture.Run,.1,!0);this.jumpAnimation=new Platformer2D.Animation(Platformer2D.GameContent.Texture.Jump,.1,!1);this.celebrateAnimation=new Platformer2D.Animation(Platformer2D.GameContent.Texture.Celebrate,.1,!1);this.dieAnimation=new Platformer2D.Animation(Platformer2D.GameContent.Texture.Die,.1,!1);var width=Bridge.Int.clip32(this.idleAnimation.FrameWidth*.4),left=Bridge.Int.div(this.idleAnimation.FrameWidth-width|0,2)|0,height=Bridge.Int.clip32(this.idleAnimation.FrameWidth*.8),top=this.idleAnimation.FrameHeight-height|0;this.localBounds=new Microsoft.Xna.Framework.Rectangle.$ctor2(left,top,width,height)},Reset:function(position){this.Position=position.$clone();this.Velocity=Microsoft.Xna.Framework.Vector2.Zero.$clone();this.isAlive=!0;this.sprite.PlayAnimation(this.idleAnimation)},Update:function(gameTime,keyboardState,gamePadState,accelState,orientation){this.GetInput(keyboardState.$clone(),gamePadState.$clone(),accelState.$clone(),orientation);this.ApplyPhysics(gameTime);this.IsAlive&&this.IsOnGround&&(Math.abs(this.Velocity.X)-.02>0?this.sprite.PlayAnimation(this.runAnimation):this.sprite.PlayAnimation(this.idleAnimation));this.movement=0;this.isJumping=!1},GetInput:function(keyboardState,gamePadState,accelState,orientation){this.movement=gamePadState.ThumbSticks.Left.X*Platformer2D.Player.MoveStickScale;Math.abs(this.movement)<.5&&(this.movement=0);Math.abs(accelState.Acceleration.Y)>.1&&(this.movement=Microsoft.Xna.Framework.MathHelper.Clamp$1(-accelState.Acceleration.Y*Platformer2D.Player.AccelerometerScale,-1,1),orientation===Microsoft.Xna.Framework.DisplayOrientation.LandscapeRight&&(this.movement=-this.movement));gamePadState.IsButtonDown(Microsoft.Xna.Framework.Input.Buttons.DPadLeft)||keyboardState.IsKeyDown(Microsoft.Xna.Framework.Input.Keys.Left)||keyboardState.IsKeyDown(Microsoft.Xna.Framework.Input.Keys.A)?this.movement=-1:(gamePadState.IsButtonDown(Microsoft.Xna.Framework.Input.Buttons.DPadRight)||keyboardState.IsKeyDown(Microsoft.Xna.Framework.Input.Keys.Right)||keyboardState.IsKeyDown(Microsoft.Xna.Framework.Input.Keys.D))&&(this.movement=1);this.isJumping=gamePadState.IsButtonDown(Platformer2D.Player.JumpButton)||keyboardState.IsKeyDown(Microsoft.Xna.Framework.Input.Keys.Space)||keyboardState.IsKeyDown(Microsoft.Xna.Framework.Input.Keys.Up)||keyboardState.IsKeyDown(Microsoft.Xna.Framework.Input.Keys.W)},ApplyPhysics:function(gameTime){var elapsed=gameTime.ElapsedGameTime.getTotalSeconds(),previousPosition=this.Position.$clone();this.velocity.X+=this.movement*Platformer2D.Player.MoveAcceleration*elapsed;this.velocity.Y=Microsoft.Xna.Framework.MathHelper.Clamp$1(this.velocity.Y+Platformer2D.Player.GravityAcceleration*elapsed,-550,Platformer2D.Player.MaxFallSpeed);this.velocity.Y=this.DoJump(this.velocity.Y,gameTime);this.velocity.X*=this.IsOnGround?Platformer2D.Player.GroundDragFactor:Platformer2D.Player.AirDragFactor;this.velocity.X=Microsoft.Xna.Framework.MathHelper.Clamp$1(this.velocity.X,-1750,Platformer2D.Player.MaxMoveSpeed);this.Position=Microsoft.Xna.Framework.Vector2.op_Addition(this.Position.$clone(),Microsoft.Xna.Framework.Vector2.op_Multiply$1(this.velocity.$clone(),elapsed));this.Position=new Microsoft.Xna.Framework.Vector2.$ctor2(Bridge.Math.round(this.Position.X,0,6),Bridge.Math.round(this.Position.Y,0,6));this.HandleCollisions();this.Position.X===previousPosition.X&&(this.velocity.X=0);this.Position.Y===previousPosition.Y&&(this.velocity.Y=0)},DoJump:function(velocityY,gameTime){return this.isJumping?((!this.wasJumping&&this.IsOnGround||this.jumpTime>0)&&(this.jumpTime===0&&Platformer2D.GameContent.SoundEffects.jumpSound.Play(),this.jumpTime+=gameTime.ElapsedGameTime.getTotalSeconds(),this.sprite.PlayAnimation(this.jumpAnimation)),0<this.jumpTime&&this.jumpTime<=Platformer2D.Player.MaxJumpTime?velocityY=Platformer2D.Player.JumpLaunchVelocity*(1-Math.pow(this.jumpTime/Platformer2D.Player.MaxJumpTime,Platformer2D.Player.JumpControlPower)):this.jumpTime=0):this.jumpTime=0,this.wasJumping=this.isJumping,velocityY},HandleCollisions:function(){var bounds=this.BoundingRectangle.$clone(),leftTile=Bridge.Int.clip32(Math.floor(bounds.Left/Platformer2D.Tile.Width)),rightTile=Bridge.Int.clip32(Math.ceil(bounds.Right/Platformer2D.Tile.Width))-1|0,topTile=Bridge.Int.clip32(Math.floor(bounds.Top/Platformer2D.Tile.Height)),bottomTile=Bridge.Int.clip32(Math.ceil(bounds.Bottom/Platformer2D.Tile.Height))-1|0,y,x,collision,tileBounds,depth,absDepthX,absDepthY;for(this.isOnGround=!1,y=topTile;y<=bottomTile;y=y+1|0)for(x=leftTile;x<=rightTile;x=x+1|0)collision=this.Level.GetCollision(x,y),collision!==Platformer2D.TileCollision.Passable&&(tileBounds=this.Level.GetBounds(x,y),depth=Platformer2D.RectangleExtensions.GetIntersectionDepth(bounds.$clone(),tileBounds.$clone()),Microsoft.Xna.Framework.Vector2.op_Inequality(depth.$clone(),Microsoft.Xna.Framework.Vector2.Zero.$clone())&&(absDepthX=Math.abs(depth.X),absDepthY=Math.abs(depth.Y),absDepthY<absDepthX||collision===Platformer2D.TileCollision.Platform?(this.previousBottom<=tileBounds.Top&&(this.isOnGround=!0),(collision===Platformer2D.TileCollision.Impassable||this.IsOnGround)&&(this.Position=new Microsoft.Xna.Framework.Vector2.$ctor2(this.Position.X,this.Position.Y+depth.Y),bounds=this.BoundingRectangle.$clone())):collision===Platformer2D.TileCollision.Impassable&&(this.Position=new Microsoft.Xna.Framework.Vector2.$ctor2(this.Position.X+depth.X,this.Position.Y),bounds=this.BoundingRectangle.$clone())));this.previousBottom=bounds.Bottom},OnKilled:function(killedBy){this.isAlive=!1;killedBy!=null?Platformer2D.GameContent.SoundEffects.killedSound.Play():Platformer2D.GameContent.SoundEffects.fallSound.Play();this.sprite.PlayAnimation(this.dieAnimation)},OnReachedExit:function(){this.sprite.PlayAnimation(this.celebrateAnimation)},Draw:function(gameTime,spriteBatch){this.Velocity.X>0?this.flip=Microsoft.Xna.Framework.Graphics.SpriteEffects.FlipHorizontally:this.Velocity.X<0&&(this.flip=Microsoft.Xna.Framework.Graphics.SpriteEffects.None);this.sprite.Draw(gameTime,spriteBatch,this.Position.$clone(),this.flip)}}});Bridge.define("Platformer2D.RectangleExtensions",{statics:{methods:{GetIntersectionDepth:function(rectA,rectB){var halfWidthA=rectA.Width/2,halfHeightA=rectA.Height/2,halfWidthB=rectB.Width/2,halfHeightB=rectB.Height/2,centerA=new Microsoft.Xna.Framework.Vector2.$ctor2(rectA.Left+halfWidthA,rectA.Top+halfHeightA),centerB=new Microsoft.Xna.Framework.Vector2.$ctor2(rectB.Left+halfWidthB,rectB.Top+halfHeightB),distanceX=centerA.X-centerB.X,distanceY=centerA.Y-centerB.Y,minDistanceX=halfWidthA+halfWidthB,minDistanceY=halfHeightA+halfHeightB,depthX,depthY;return Math.abs(distanceX)>=minDistanceX||Math.abs(distanceY)>=minDistanceY?Microsoft.Xna.Framework.Vector2.Zero.$clone():(depthX=distanceX>0?minDistanceX-distanceX:-minDistanceX-distanceX,depthY=distanceY>0?minDistanceY-distanceY:-minDistanceY-distanceY,new Microsoft.Xna.Framework.Vector2.$ctor2(depthX,depthY))},GetBottomCenter:function(rect){return new Microsoft.Xna.Framework.Vector2.$ctor2(rect.X+rect.Width/2,rect.Bottom)}}}});Bridge.define("Platformer2D.Tile",{$kind:"struct",statics:{fields:{Width:0,Height:0,Size:null},ctors:{init:function(){this.Size=new Microsoft.Xna.Framework.Vector2;this.Width=40;this.Height=32;this.Size=new Microsoft.Xna.Framework.Vector2.$ctor2(Platformer2D.Tile.Width,Platformer2D.Tile.Height)}},methods:{getDefaultValue:function(){return new Platformer2D.Tile}}},fields:{Texture:null,Collision:0},ctors:{$ctor1:function(texture,collision){this.$initialize();this.Texture=texture;this.Collision=collision},ctor:function(){this.$initialize()}},methods:{getHashCode:function(){return Bridge.addHash([1701603668,this.Texture,this.Collision])},equals:function(o){return Bridge.is(o,Platformer2D.Tile)?Bridge.equals(this.Texture,o.Texture)&&Bridge.equals(this.Collision,o.Collision):!1},$clone:function(to){var s=to||new Platformer2D.Tile;return s.Texture=this.Texture,s.Collision=this.Collision,s}}});Bridge.define("Platformer2D.TileCollision",{$kind:"enum",statics:{fields:{Passable:0,Impassable:1,Platform:2}}});Bridge.define("Platformer2D.TouchCollectionExtensions",{statics:{methods:{AnyTouch:function(touchState){var $t,location;$t=Bridge.getEnumerator(touchState);try{while($t.moveNext())if(location=$t.Current.$clone(),location.State===Microsoft.Xna.Framework.Input.Touch.TouchLocationState.Pressed||location.State===Microsoft.Xna.Framework.Input.Touch.TouchLocationState.Moved)return!0}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$Dispose()}return!1}}}});Bridge.define("Platformer2D.VirtualGamePad",{fields:{baseScreenSize:null,globalTransformation:null,texture:null,secondsSinceLastInput:0,opacity:0},ctors:{init:function(){this.baseScreenSize=new Microsoft.Xna.Framework.Vector2;this.globalTransformation=new Microsoft.Xna.Framework.Matrix},ctor:function(baseScreenSize,globalTransformation,texture){this.$initialize();this.baseScreenSize=baseScreenSize.$clone();this.globalTransformation=Microsoft.Xna.Framework.Matrix.Invert(globalTransformation.$clone());this.texture=texture;this.secondsSinceLastInput=340282347e30}},methods:{NotifyPlayerIsMoving:function(){this.secondsSinceLastInput=0},Update:function(gameTime){var secondsElapsed=gameTime.ElapsedGameTime.getTotalSeconds();this.secondsSinceLastInput+=secondsElapsed;this.opacity=this.secondsSinceLastInput<4?Math.max(0,this.opacity-secondsElapsed*4):Math.min(1,this.opacity+secondsElapsed*2)},Draw:function(spriteBatch){var spriteCenter=new Microsoft.Xna.Framework.Vector2.$ctor2(64,64),color=Microsoft.Xna.Framework.Color.Multiply(Microsoft.Xna.Framework.Color.White.$clone(),this.opacity);spriteBatch.Draw$6(this.texture,new Microsoft.Xna.Framework.Vector2.$ctor2(64,this.baseScreenSize.$clone().Y-64),null,color.$clone(),-1.57079637,spriteCenter.$clone(),1,Microsoft.Xna.Framework.Graphics.SpriteEffects.None,0);spriteBatch.Draw$6(this.texture,new Microsoft.Xna.Framework.Vector2.$ctor2(192,this.baseScreenSize.$clone().Y-64),null,color.$clone(),Microsoft.Xna.Framework.MathHelper.PiOver2,spriteCenter.$clone(),1,Microsoft.Xna.Framework.Graphics.SpriteEffects.None,0);spriteBatch.Draw$6(this.texture,new Microsoft.Xna.Framework.Vector2.$ctor2(this.baseScreenSize.$clone().X-128,this.baseScreenSize.$clone().Y-128),null,color.$clone(),0,Microsoft.Xna.Framework.Vector2.Zero.$clone(),1,Microsoft.Xna.Framework.Graphics.SpriteEffects.None,0)},GetState:function(touchState,gpState){var $t,buttonsPressed=0,touch,pos,gpButtons,buttons;$t=Bridge.getEnumerator(touchState);try{while($t.moveNext())touch=$t.Current.$clone(),(touch.State===Microsoft.Xna.Framework.Input.Touch.TouchLocationState.Moved||touch.State===Microsoft.Xna.Framework.Input.Touch.TouchLocationState.Pressed)&&(pos={v:touch.Position.$clone()},Microsoft.Xna.Framework.Vector2.Transform$2(pos,Bridge.ref(this,"globalTransformation"),pos),pos.v.X<128?buttonsPressed|=Microsoft.Xna.Framework.Input.Buttons.DPadLeft:pos.v.X<256?buttonsPressed|=Microsoft.Xna.Framework.Input.Buttons.DPadRight:pos.v.X>=this.baseScreenSize.$clone().X-128&&(buttonsPressed|=Microsoft.Xna.Framework.Input.Buttons.A))}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$Dispose()}return gpButtons=gpState.Buttons,buttonsPressed|=gpButtons.A===Microsoft.Xna.Framework.Input.ButtonState.Pressed?Microsoft.Xna.Framework.Input.Buttons.A:0,buttonsPressed|=gpButtons.B===Microsoft.Xna.Framework.Input.ButtonState.Pressed?Microsoft.Xna.Framework.Input.Buttons.B:0,buttonsPressed|=gpButtons.X===Microsoft.Xna.Framework.Input.ButtonState.Pressed?Microsoft.Xna.Framework.Input.Buttons.X:0,buttonsPressed|=gpButtons.Y===Microsoft.Xna.Framework.Input.ButtonState.Pressed?Microsoft.Xna.Framework.Input.Buttons.Y:0,buttonsPressed|=gpButtons.Start===Microsoft.Xna.Framework.Input.ButtonState.Pressed?Microsoft.Xna.Framework.Input.Buttons.Start:0,buttonsPressed|=gpButtons.Back===Microsoft.Xna.Framework.Input.ButtonState.Pressed?Microsoft.Xna.Framework.Input.Buttons.Back:0,buttonsPressed|=gpState.IsButtonDown(Microsoft.Xna.Framework.Input.Buttons.DPadDown)?Microsoft.Xna.Framework.Input.Buttons.DPadDown:0,buttonsPressed|=gpState.IsButtonDown(Microsoft.Xna.Framework.Input.Buttons.DPadLeft)?Microsoft.Xna.Framework.Input.Buttons.DPadLeft:0,buttonsPressed|=gpState.IsButtonDown(Microsoft.Xna.Framework.Input.Buttons.DPadRight)?Microsoft.Xna.Framework.Input.Buttons.DPadRight:0,buttonsPressed|=gpState.IsButtonDown(Microsoft.Xna.Framework.Input.Buttons.DPadUp)?Microsoft.Xna.Framework.Input.Buttons.DPadUp:0,buttonsPressed|=gpButtons.BigButton===Microsoft.Xna.Framework.Input.ButtonState.Pressed?Microsoft.Xna.Framework.Input.Buttons.BigButton:0,buttonsPressed|=gpButtons.LeftShoulder===Microsoft.Xna.Framework.Input.ButtonState.Pressed?Microsoft.Xna.Framework.Input.Buttons.LeftShoulder:0,buttonsPressed|=gpButtons.RightShoulder===Microsoft.Xna.Framework.Input.ButtonState.Pressed?Microsoft.Xna.Framework.Input.Buttons.RightShoulder:0,buttonsPressed|=gpButtons.LeftStick===Microsoft.Xna.Framework.Input.ButtonState.Pressed?Microsoft.Xna.Framework.Input.Buttons.LeftStick:0,buttonsPressed|=gpButtons.RightStick===Microsoft.Xna.Framework.Input.ButtonState.Pressed?Microsoft.Xna.Framework.Input.Buttons.RightStick:0,buttons=new Microsoft.Xna.Framework.Input.GamePadButtons.$ctor1(buttonsPressed),new Microsoft.Xna.Framework.Input.GamePadState.$ctor1(gpState.ThumbSticks,gpState.Triggers.$clone(),buttons,gpState.DPad.$clone())}}})});